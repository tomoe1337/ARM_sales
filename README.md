# ARM Sales - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∂–∞–º–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–õ–æ–∫–∞–ª—å–Ω–æ)

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
2. –°–æ–∑–¥–∞–π—Ç–µ `laravel/.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `laravel/.env.example`.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
   ```bash
   docker-compose up -d
   ```
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   docker-compose exec php composer install
   docker-compose exec php php artisan key:generate
   docker-compose exec php php artisan migrate --seed
   ```

---

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Production (Beget / VPS)

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –∏ SSL (HTTPS)
–î–ª—è —Ä–∞–±–æ—Ç—ã –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (YooKassa/Robokassa) **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** —Ç—Ä–µ–±—É–µ—Ç—Å—è HTTPS.

**–®–∞–≥ –ê: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–Ω–∞ —Ö–æ—Å—Ç–µ)**
–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Nginx, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Certbot –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:
```bash
docker-compose stop nginx
sudo apt update && sudo apt install certbot -y
sudo certbot certonly --standalone -d bluestats.khodzhji.beget.tech
```

**–®–∞–≥ –ë: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
–í –∫–æ—Ä–Ω–µ–≤–æ–º —Ñ–∞–π–ª–µ `.env` (—Ä—è–¥–æ–º —Å `docker-compose.yml`) —É–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥ Nginx –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
```env
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å production.conf –¥–ª—è HTTPS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è default.conf)
NGINX_CONF=production.conf
```

**–®–∞–≥ –í: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Docker**
```bash
docker-compose up -d --force-recreate
```

### 2. –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
–í —Ñ–∞–π–ª–µ `laravel/.env` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

**YooKassa:**
- `PAYMENT_GATEWAY=yookassa`
- `YOOKASSA_SHOP_ID` (–∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞)
- `YOOKASSA_SECRET_KEY` (–ø–æ–ª–Ω—ã–π –∫–ª—é—á **–±–µ–∑ –∑–≤–µ–∑–¥–æ—á–µ–∫**)

**Webhook URL –¥–ª—è YooKassa:**
`https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/payments/callback/yookassa`

---

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –£–º–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç (Smart Polling)
–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤ YooKassa –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ –º–∞—Ä—à—Ä—É—Ç `/payment/check/{id}`. –°–µ—Ä–≤–µ—Ä –¥–µ–ª–∞–µ—Ç 4 –ø–æ–ø—ã—Ç–∫–∏ (–∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫) –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤–µ–±—Ö—É–∫–∞ –≤ –±–∞–∑–µ, –ø—Ä–µ–∂–¥–µ —á–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—Ö–∞ –∏–ª–∏ –æ—à–∏–±–∫–∏. –≠—Ç–æ —Å–≥–ª–∞–∂–∏–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏.

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Docker**: PHP 8.4-FPM, PostgreSQL 15, Nginx.
- **SSL**: –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ `/etc/letsencrypt` —Ö–æ—Å—Ç–æ–≤–æ–π –º–∞—à–∏–Ω—ã –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Nginx –≤ —Ä–µ–∂–∏–º–µ `readonly`.
- **Rate Limiting**: –î–ª—è API (–≤–∫–ª—é—á–∞—è –≤–µ–±—Ö—É–∫–∏) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏–º–∏—Ç–µ—Ä `60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω`.
